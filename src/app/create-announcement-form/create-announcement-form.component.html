<div class="container container-tight" mode="vertical">
    <!-- Loading when submitting the announcement -->
    <md-spinner [color]="primary" style="margin: 0 auto; width: 60px; height: 60px;" *ngIf="loading"></md-spinner>
    <!-- Success! -->
    <td-message *ngIf="success && submitted && !loading" label="Success" sublabel="Your announcement has successfully been submitted for approval." color="green" icon="done" style="padding: 16px 5px;">
        <button td-message-actions md-button routerLink="/me">RETURN TO USER PANEL</button>
    </td-message>
    <td-message *ngIf="!success && submitted && !loading" label="Error" sublabel="There was an error in submitting your announcement." color="primary" icon="warning" style="padding: 16px 5px; margin-bottom: 15px;">
        <button td-message-actions md-button (click)="closeErrorDialog()">CLOSE</button>
    </td-message>
    <!-- Stepper -->
    <td-steps *ngIf="!success && !loading">
        <td-step #step1 label="Basic Info" sublabel="Announcement Title & Description" [active]="stepNumber === 1" style="width:100%;" (activated)="setStepNumber(1)" [disableRipple]="true">
            <h3>Basic Info</h3>
            <!-- Error Message -->
            <td-message *ngIf="stepError === 1" label="Warning" sublabel="Use at least 10 characters in your announcement title and description." color="primary" icon="warning" style="padding: 16px 5px; margin-bottom: 15px;"></td-message>
            <!-- Announcement inputs -->
            <md-input-container>
                <input mdInput required [(ngModel)]="announcement.title" placeholder="Title" style="width: 300px;" />
            </md-input-container><br>
            <md-input-container>
                <textarea mdInput required [(ngModel)]="announcement.description" placeholder="Description" style="width: 720px; height: 100px;"></textarea>
            </md-input-container><br>
            <!-- Continue Button -->
            <ng-template td-step-actions>
                <button md-raised-button (click)="addStepNumber(1)">CONTINUE</button>
            </ng-template>
        </td-step>
        <td-step #step2 label="Display Dates" sublabel="Window of Dates for the Announcement to Appear" [active]="stepNumber === 2" (activated)="setStepNumber(2)" [disableRipple]="true">
            <h3>Dates</h3>
            <!-- Error Message -->
            <td-message *ngIf="stepError === 2" label="Warning" sublabel="Please select or input a valid start and end date. The start date must come before the end date." color="primary" icon="warning" style="padding: 16px 5px; margin-bottom: 15px;"></td-message>
            <!-- Date inputs -->
            <md-input-container>
                <input mdInput [mdDatepicker]="announceStartDate" placeholder="Start Date" [(ngModel)]="announcement.startDate">
                <button mdSuffix [mdDatepickerToggle]="announceStartDate"></button>
            </md-input-container>
            <md-datepicker #announceStartDate></md-datepicker><br>
            <md-input-container>
                <input mdInput [mdDatepicker]="announceEndDate" placeholder="End Date" [(ngModel)]="announcement.endDate">
                <button mdSuffix [mdDatepickerToggle]="announceEndDate"></button>
            </md-input-container>
            <md-datepicker #announceEndDate></md-datepicker>
            <!-- Continue Button -->
            <ng-template td-step-actions>
                <button md-raised-button (click)="addStepNumber(2)">CONTINUE</button>
            </ng-template>
        </td-step>
        <td-step #step3 label="Tags" sublabel="Categories & Grades" [active]="stepNumber === 3" (activated)="setStepNumber(3)" [disableRipple]="true">
            <div class="step-three">
                <td-message *ngIf="stepError === 3" label="Warning" sublabel="Your announcement must contain one category and one grade level." color="primary" icon="warning" style="padding: 16px 5px; margin-bottom: 15px;"></td-message>
                <h3>Categories</h3>
                <small></small>
                <!-- Error Message -->
                <!--<td-chips
                    [chipAddition]="true"
                    [chipRemoval]="true"
                    [(ngModel)]="announcement.tagsStrings"
                    [items]="filteredTagsStrings"
                    (inputChange)="filterTags($event)"
                    placeholder="Click to add a tag..."
                    requireMatch>
                </td-chips>-->
                <br>
                <md-select placeholder="Category" [(ngModel)]="announcement.category">
                    <md-option *ngFor="let category of allCategories" [value]="category.id">{{category.name}}</md-option>
                </md-select>
                <h3>Grades</h3>
                <md-checkbox [(ngModel)]="announcement.grades.grade7">Grade 7</md-checkbox>
                <md-checkbox [(ngModel)]="announcement.grades.grade8">Grade 8</md-checkbox>
                <md-checkbox [(ngModel)]="announcement.grades.grade9">Grade 9</md-checkbox>
                <md-checkbox [(ngModel)]="announcement.grades.grade10">Grade 10</md-checkbox>
                <md-checkbox [(ngModel)]="announcement.grades.grade11">Grade 11</md-checkbox>
                <md-checkbox [(ngModel)]="announcement.grades.grade12">Grade 12</md-checkbox>
                <br><br>
                <button md-button (click)="selectGrades('middle')">GRADES 7/8</button>
                <button md-button (click)="selectGrades('high')">GRADES 9-12</button>
                <button md-button (click)="selectGrades('all')" *ngIf="!selectGrades('hasAllSelected')">ALL GRADES</button>
                <button md-button (click)="selectGrades('none')" *ngIf="selectGrades('hasAllSelected')">NO GRADES</button>
                <br>
                <h3>Miscellaneous</h3>
                <md-checkbox [(ngModel)]="announcement.isUrgent" (click)="confirmUrgency()">Tag as Urgent</md-checkbox><br>
                <small style="display: block; margin-top: 15px;">
                    The urgent tag should <i>only</i> be reserved for <b>critical</b> and <b>time-sensitive</b> notices. Once an urgent announcement is approved,
                    an app notification will be sent out to all Spartan Connect users. Exercise caution before enabling this option.
                </small>
            </div>
            <!-- Continue Button -->
            <ng-template td-step-actions>
                <button md-raised-button (click)="addStepNumber(3)">CONTINUE</button>
            </ng-template>
        </td-step>
        <td-step #step4 label="Events" sublabel="Dates to Attach to Your Announcement" [active]="stepNumber === 4" (activated)="setStepNumber(4)" [disableRipple]="true">
            <h3>Events</h3>
            <p>Events are currently a work-in-progress feature and are not available in this version of the web app.</p>
            <!-- Continue Button -->
            <ng-template td-step-actions>
                <button md-raised-button (click)="addStepNumber(4)">CONTINUE</button>
            </ng-template>
        </td-step>
        <td-step #step5 label="Confirmation" sublabel="Confirm Your Announcement" [active]="stepNumber === 5" (activated)="setStepNumber(5)" [disableRipple]="true">
            <!-- Example Announcement -->
            <md-card class="card-announcement">
                <md-card-header>
                    <div md-card-avatar class="example-header-image" style="background-image:url('http://via.placeholder.com/40/b71c1c/ffffff')"></div>
                    <md-card-title>{{announcement.creatorName}} (You)</md-card-title>
                    <md-card-subtitle>Displaying from {{(announcement.startDate | date:'yMd') || "(no start date)"}} to {{(announcement.endDate | date:'yMd') || "(no end date)"}}</md-card-subtitle>
                </md-card-header>
                <md-card-content style="margin-bottom: 0">
                    <h3>{{announcement.title || "(no title)"}}</h3>
                    <p>{{announcement.description || "(no description)"}}</p>
                    <md-chip-list *ngIf="announcement.tagsStrings">
                        <md-chip *ngFor="let tag of announcement.tagsStrings">{{tag}}</md-chip>
                    </md-chip-list>
                </md-card-content>
                <md-card-actions>
                    <button md-button>READ MORE</button>
                    <button md-button>EDIT</button>
                </md-card-actions>
            </md-card>
            <!-- Continue Button -->
            <ng-template td-step-actions>
                <button md-raised-button (click)="submitForm()">SUBMIT</button>
            </ng-template>
        </td-step>
    </td-steps>
</div>
